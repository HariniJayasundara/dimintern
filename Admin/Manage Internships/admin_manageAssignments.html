<!DOCTYPE html>
<html>
<head>
  <title>Admin - Manage Assignments</title>
  <style type="text/css">
    html, body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            height: 100%;
        }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    tr:hover {
      background-color: #f2f2f2;
    }

    .filter-container {
      margin-bottom: 10px;
    }

    .filter-input {
      padding: 5px;
    }

    .filter-btn {
      padding: 5px 10px;
      background-color: #03a68d;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    footer {
  background-color: #03a68d;
  color: white;
  text-align: center;
  padding: 20px;
  margin: 0px;
  width: 100%;
  position: fixed;
  bottom: 0;
}

.footer-content {
  font-size: 14px;
}
  </style>
</head>
<body>
  <h1>Admin - View Assignment Status</h1>

  <div class="filter-container">
    <input type="text" class="filter-input" id="studentFilter" placeholder="Filter by Student Number">
    <input type="text" class="filter-input" id="preferenceFilter" placeholder="Filter by Preference">
    <input type="text" class="filter-input" id="companyFilter" placeholder="Filter by Company">
    <input type="text" class="filter-input" id="statusFilter" placeholder="Filter by Status">
    <button class="filter-btn" onclick="applyFilters()">Apply Filters</button>
    <button class="filter-btn" onclick="resetFilters()">Reset Filters</button>
  </div>

  <div class="container">
    <table id="assignments-table">
      <thead>
        <tr>
          <th>Student Number</th>
          <th>Preference</th>
          <th>Company</th>
          <th>Current Status</th>
        </tr>
      </thead>
      <tbody id="assignments-body">
        <!-- Table body content will be populated dynamically -->
      </tbody>
    </table>
  </div>

  <footer>
    <div class="footer-content">
      Department of Industrial Management - Faculty of Science - University of Kelaniya
    </div>
  </footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    // The initial data fetched from the server
    var originalAssignments = [];

    $(document).ready(function() {
      // Make an AJAX request to fetch student assignments
      $.ajax({
        url: 'admin_viewAssignments.php',
        type: 'POST',
        dataType: 'json',
        success: function(data) {
          originalAssignments = data.assignments;
          updateTable(originalAssignments);
        },
        error: function() {
          alert('Error: Failed to fetch student assignments.');
        }
      });
    });

    function applyFilters() {
      var studentFilter = $('#studentFilter').val().trim().toLowerCase();
      var preferenceFilter = $('#preferenceFilter').val().trim().toLowerCase();
      var companyFilter = $('#companyFilter').val().trim().toLowerCase();
      var statusFilter = $('#statusFilter').val().trim().toLowerCase();

      var filteredAssignments = originalAssignments.filter(function(assignment) {
        return (
          (assignment.student_number.toLowerCase().indexOf(studentFilter) !== -1) &&
          (assignment.preference_name.toLowerCase().indexOf(preferenceFilter) !== -1) &&
          (assignment.company_name.toLowerCase().indexOf(companyFilter) !== -1) &&
          (assignment.current_status.toLowerCase().indexOf(statusFilter) !== -1)
        );
      });

      updateTable(filteredAssignments);
    }

    function resetFilters() {
      $('#studentFilter').val('');
      $('#preferenceFilter').val('');
      $('#companyFilter').val('');
      $('#statusFilter').val('');

      updateTable(originalAssignments);
    }

    function updateTable(assignments) {
      var assignmentsList = '';
      for (var i = 0; i < assignments.length; i++) {
        var studentNumber = assignments[i].student_number;
        var preference = assignments[i].preference_name;
        var companyName = assignments[i].company_name;
        var currentStatus = assignments[i].current_status;

        assignmentsList += '<tr>';
        assignmentsList += '<td>' + studentNumber + '</td>';
        assignmentsList += '<td>' + preference + '</td>';
        assignmentsList += '<td>' + companyName + '</td>';
        assignmentsList += '<td>' + currentStatus + '</td>';
        assignmentsList += '</tr>';
      }

      $('#assignments-body').html(assignmentsList);
    }
  </script>
</body>
</html>